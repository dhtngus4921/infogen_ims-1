<script type="text/javascript">
    var initFlag = true;

    /*********************************************************************
    *   Dialog Setting
    *********************************************************************/
    var n_dialog = new ax5.ui.dialog();
    var n_title =  '<span style="color:#fd7e14;font-size:20px;"><i class="fa fa-check-circle"></i></span> CHECK';

    n_dialog.setConfig({
        title: n_title,
        theme : 'info',
        lang:{
            "ok": "확인", "cancel": "취소"
        }
    });

    $(document).ready(function(){


        /* 부모창에서 선택한 직원 email*/
        $('#hidden_empMail').val(document.getElementById('hidden_selectMail').value);

        var email = document.getElementById('hidden_selectMail').value;

        getEditEmpInfo(email);

    });

    /* 해당 직원 정보 조회 */
    function getEditEmpInfo(email){
        var param = {
        "email" : email
        }

        /* 정보 조회 */
        $.ajaxCall( param, {
             'method' : 'GET',
             'url' : "{% url 'dili_api:getEditEmpInfo' %}",
             'dataType' : 'json',
             'data' : JSON.stringify(param),
             'async' : false,
             'callbackFn' : function(data){
                // 로그
                console.log("data : ",data);
                // 리턴
                empInfoSet(data);
             }
        });
    }

    /* 해당 직원 정보 input창에 입력 */
    function empInfoSet(data){
        console.log("Start")
        console.log(data)
        console.log(typeof(data))

        var get_empId = data[0].EMP_ID;
        var get_empPw = data[0].EMP_PW;
        var get_empAId = data[0].AUTH_ID;
        var get_empName = data[0].EMP_NAME;
        var get_empBd = data[0].EMP_BDAY;
        var get_empTel = data[0].EMP_TEL;
        var get_empDCd = data[0].DEPT_CD;


        if(initFlag) {
            // 공통 코드 조회 - '부서조회'
            retrieveCmmCd('sbx_empDept', 'SLIN_BZDP', function(){
                $("#sbx_empDept option[value='"+get_empDCd+"']").attr("selected", true);
            });
            // 공통 코드 조회 - '권한 조회'
            retrieveCmmCd('sbx_empAuthId', 'AUTH_CD', function(){
                $("#sbx_empAuthId option[value='"+get_empAId+"']").attr("selected", true);
            });
            initFlag = false;
        } else {
            $("#sbx_empDept option").removeAttr("selected")
            $("#sbx_empDept option[value='"+get_empDCd+"']").attr("selected", true);
            $("#sbx_empAuthId option").removeAttr("selected")
            $("#sbx_empAuthId option[value='"+get_empAId+"']").attr("selected", true);
         }

        $('#ipt_empId').val(get_empId);
        $('#ipt_empPw').val(get_empPw);
        $('#ipt_empNm').val(get_empName);
        $('#ipt_empBd').val(get_empBd);
        $('#ipt_empMb').val(get_empTel);

    };

    /* 수정버튼 클릭 이벤트 */
    function onClickEditBtn() {
        var ipt_empId = $('[name="ipt_empId"]').val();
        var ipt_empPw = $('[name="ipt_empPw"]').val();
        var ipt_empAuthId = $('[name="sbx_empAuthId"] option:selected').val();
        var ipt_empNm = $('[name="ipt_empNm"]').val();
        var ipt_empBd = $('[name="ipt_empBd"]').val();
        var ipt_empMb = $('[name="ipt_empMb"]').val();
        var ipt_empDept = $('[name="sbx_empDept"] option:selected').val();

        if( ipt_empId == "" || ipt_empId == null ){
            alert("직원 아이디를 입력해 주세요.");
            return false;
        } else if (ipt_empPw == "" || ipt_empPw == null ){
            alert("직원 비밀번호를 입력해 주세요.");
            return false;
        } else if (ipt_empAuthId == "none" || ipt_empAuthId == null ){
            alert("직원 권한을 선택해 주세요.");
            return false;
        } else if (ipt_empNm == "" || ipt_empNm == null ){
            alert("직원 이름을 입력해 주세요.");
            return false;
        } else if (ipt_empBd == "" || ipt_empBd == null ){
            alert("직원 생년월일을 입력해 주세요.");
            return false;
        } else if (ipt_empMb == "" || ipt_empMb == null ){
            alert("직원 연락처를 입력해 주세요.");
            return false;
        } else if (ipt_empDept == "00" || ipt_empDept == null ){
            alert("직원 부서를 선택해 주세요.");
            return false;
        } else if (ipt_empNm.length < 2){
            alert("직원 이름은 두 글자 이상 입력해 주세요.");
            return false;
        }else if (ipt_empMb.length < 13){
            alert("직원 연락처는 010-0000-0000 형식으로 입력해 주세요.");
            return false;
        }

        var param = {
            "ipt_empId" : ipt_empId,
            "ipt_empPw" : ipt_empPw,
            "ipt_empAuthId" : ipt_empAuthId,
            "ipt_empNm" : ipt_empNm,
            "ipt_empBd" : ipt_empBd,
            "ipt_empMb" : ipt_empMb,
            "ipt_empDept" : ipt_empDept
        }

        n_dialog.confirm('수정하시겠습니까?',function(){
                if(this.key == 'ok'){       //확인클릭시
                    $.ajaxCall( param, {
                        method:'POST',
                        url : "{% url 'dili_api:empMgmtEdit' %}",
                        dataType:'json',
                        data:JSON.stringify(param),
                        callbackFn:function(data){
                            if(data){
                                // 리턴
                                 //location.href = "{% url 'dili_api:empMgmt' %}";
                                 url = "{% url 'dili_api:empMgmt' %}";
                                 $('#grd_empListTable').load(url);
                                 $('#exitEmpModalBtn').click();
                                 g_toast.push("성공적으로 수정되었습니다.");
                                 console.log("수정되었습니다.");

                                //sFlag = true;
                                //fileSave();
                            } else{
                                g_toast.push("수정에 실패하였습니다.");
                                console.log("수정에 실패하였습니다.");
                                location.reload();
                            }
                        }
                   });
                }else{     //취소클릭시
                    g_toast.push("취소하였습니다.");
                    console.log("취소하였습니다.");
                    //location.reload();
                }

            });

    };

    /* 리셋 버튼 클릭 이벤트 */
    function onClickResetBtn() {
        var email = document.getElementById('hidden_selectMail').value;

        getEditEmpInfo(email);
    };

    /* 삭제 버튼 클릭 이벤트 */
    function onClickDeleteBtn() {
        var ipt_empId = $('[name="ipt_empId"]').val();
        var param = {
            "ipt_empId" : ipt_empId
        }
        n_dialog.confirm('삭제하시겠습니까?',function(){
                if(this.key == 'ok'){       //확인클릭시
                    $.ajaxCall( param, {
                        method:'POST',
                        url : "{% url 'dili_api:empMgmtDel' %}",
                        dataType:'json',
                        data:JSON.stringify(param),
                        callbackFn:function(data){
                            if(data){
                                // 리턴
                                 //location.href = "{% url 'dili_api:empMgmt' %}";
                                 url = "{% url 'dili_api:empMgmt' %}";
                                 $('#grd_empListTable').load(url);
                                 $('#exitEmpModalBtn').click();
                                 g_toast.push("성공적으로 삭제되었습니다.");
                                 console.log("삭제되었습니다.");

                                //sFlag = true;
                                //fileSave();
                            } else{
                                g_toast.push("삭제에 실패하였습니다.");
                                console.log("삭제에 실패하였습니다.");
                                location.reload();
                            }
                        }
                   });
                }else{     //취소클릭시
                    g_toast.push("취소하였습니다.");
                    console.log("취소하였습니다.");
                    //location.reload();
                }

            });
    };

    /* 닫기 버튼 클릭 이벤트 */
    function onClickCloseBtn() {
        $('#exitEmpModalBtn').click();
    };

</script>
    <div class="row">
        <div class="col-sm-12">
            <div class="mb-4" role="alert">
                <h6>
                    <b>직원정보 수정/삭제</b>
                </h6>
            </div>
            <div class="flex-height d-flex m-0">
                <form method="post" id="submitEmp" action="">
                        <!-- 아이디 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-4"><label for="ipt_empId">아이디&nbsp;&nbsp;</label></div>
                            <div class="align-self-center mr-2">
                                <input type="text" class="form-control" id="ipt_empId" name="ipt_empId" placeholder="ID" maxlength="30" readonly/>
                            </div>
                        </div>
                        <!-- 비밀번호 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-3"><label for="ipt_empPw">비밀번호</label></div>
                            <div class="align-self-center mr-5">
                                <input type="password" class="form-control" id="ipt_empPw" name="ipt_empPw" placeholder="PASSWORD" maxlength="10"/>
                            </div>
                        </div>
                        <!-- 권한 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-5"><label for="sbx_empAuthId">권한</label></div>
                            <div class="align-self-center mr-5">
                                <select id="sbx_empAuthId" name="sbx_empAuthId" class="form-control">
                                    <option value="none">선택</option>
                                </select>
                            </div>
                        </div>
                        <!-- 성명 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-5"><label for="ipt_empNm">성명</label></div>
                            <div class="align-self-center mr-5">
                                <input type="text" class="form-control" id="ipt_empNm" name="ipt_empNm" placeholder="NAME" maxlength="10"/>
                            </div>
                        </div>
                        <!-- 생년월일 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-3"><label for="ipt_empBd">생년월일</label></div>
                            <div class="align-self-center mr-5">
                                <input type="date" class="form-control" id="ipt_empBd" name="ipt_empBd" maxlength="8" max="9999-12-31" />
                            </div>
                        </div>
                        <!-- 전화번호 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-3"><label for="ipt_empMb">전화번호</label></div>
                            <div class="align-self-center mr-5">
                                <input type="tel" class="form-control" id="ipt_empMb" name="ipt_empMb" maxlength="13" placeholder="000-0000-0000" />
                            </div>
                        </div>
                        <!-- 부서 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-start align-self-center mr-5"><label for="sbx_empDept">부서</label></div>
                            <div class="align-self-center mr-5">
                                <select id="sbx_empDept" name="sbx_empDept" class="form-control">
                                    <option value="00">선택</option>
                                </select>
                                <!-- 부모에서 받아온 선택된 직원 email 정보 hidden -->
                                <input type="text" class="form-control" id="hidden_empMail" name="hidden_empMail" maxlength="30" readonly hidden/>
                            </div>
                        </div>
                        <!-- 버튼 -->
                        <div class="flex-height d-flex mb-2">
                            <div class="align-self-center mr-5">
                                <button class="button" id="editBtn" type="button" onclick="onClickEditBtn()">수정</button>
                                <button class="button" id="resetBtn" type="button" onclick="onClickResetBtn()">초기화</button>
                                <button class="button" id="deleteBtn" type="button" onclick="onClickDeleteBtn()">삭제</button>
                                <button class="button" id="closeBtn" type="button" onclick="onClickCloseBtn()">닫기</button>
                            </div>

                        </div>

                </form>
            </div>
        </div>
    </div>
