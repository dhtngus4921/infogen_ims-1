
<!--
■■■■■■■ 황이성 TO-DO List  ■■■■■■■
1. 화면 Onload시 Session User Info를 통해 현재일이 포함된 주 근무시간 가져오기.
   - 조회 후 해당 데이터를 정상근무/ 초과근무(승인)/ 초과근무(미승인) 값을 기준해서 차트 그리기.
   - 동적 데이터 대상 : 근무시간 값 / 총 근무시간 / 범례 Label /
   - 차트 색 디자인 변경.

2. 직원 조회 팝업 연동 [연경씨 화면으로 이름 전달 후 Email회신]
3. Start To End Date 기준 근무시간 가져오기 함수 개발.

-->

{% extends 'common/base.html' %}
{% block content %}
{% load static %}

    <div class="container">
        <!--graph import -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

        <!--Grid UI : datepicker & monthpicker import -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/ui-lightness/jquery-ui.css" type="text/css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="{% static 'js/jquery.mtz.monthpicker.js' %}"></script>


        <script type="text/javascript" src="{% static 'js/modal.js' %}"></script>
        <link rel="stylesheet" type="text/css" href="{% static 'css/modal.css' %}"/>



        <script src="https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js"></script>
        <script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.min.js"></script>
        <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.min.js"></script>
        <script src="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.js"></script>

        <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.css" />

        <!-- If you use the default popups, use this. -->
        <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
        <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />

        <script type="text/javascript">

        $(document).ready(function(){

            $('#grp_grid').hide();                                                  // Calendar UI를 Default로 한다.
            $('#grp_showMonth').hide();                                             // Grid UI의 week를 Default로 한다.

            //현재 날짜 가져오기
            var today = new Date();
            var year = today.getFullYear(); // 년도
            var month = today.getMonth();  // 월 (today.getMonth()는 0~11로 출력)
            var date = today.getDate();  // 날짜
            var day = today.getDay();  // 요일 (0~6으로 출력, 0:일요일, 1:월요일, 6:토요일)

            $('#txt_mmYy').text(year); //그리드 월tab 년도 초기값 입력
            $('#txt_mmMm').text(month + 1); //그리드 월tab 월 초기값 입력

            crteMonthGrid();                                                                              // Month Grid 생성

            crteTodayShow(year, month, date, day);                                                        // Grid UI(주) 날짜 세팅



            /*********************************************************************
            *   Grid UI(주) 날짜 세팅
            *********************************************************************/
            function crteTodayShow(year, month, date, day){
                var strtDate = null;
                var endDate = null;

                //주tab 시작일, 종료일 입력 날짜 계산
                for(var i = 0; i < 7; i++ ){

                    if(day == i){

                        strtDate = new Date(year, Number(month), Number(date) - i);
                        endDate = new Date(year, Number(month), Number(date) + 6 - i);
                    }
                }

                $('#txt_weekStrtYy').text(strtDate.getFullYear()); //그리드 주tab 시작년도 입력
                $('#txt_weekStrtMm').text(strtDate.getMonth() + 1); //그리드 주tab 시작월 입력
                $('#txt_weekStrtDd').text(strtDate.getDate()); //그리드 주tab 시작일 입력

                $('#txt_weekEndYy').text(endDate.getFullYear()); //그리드 주tab 종료년도 입력
                $('#txt_weekEndMm').text(endDate.getMonth() + 1); //그리드 주tab 종료월 입력
                $('#txt_weekEndDd').text(endDate.getDate()); //그리드 주tab 종료일 입력

                crteWeekGrid();
            }

            /*********************************************************************
            *   Week Grid 생성
            *********************************************************************/
            function crteWeekGrid(){

                var weekTable = '<table class="table table-bordered table-responsive-md table-striped text-center">';
                weekTable += '<thead>';
                weekTable += '<tr>';
                weekTable += '<th class="text-center">일자</th>';
                weekTable += '<th class="text-center">업무시작시간</th>';
                weekTable += '<th class="text-center">업무종료시간</th>';
                weekTable += '<th class="text-center">총근무시간</th>';
                weekTable += '<th class="text-center">근무시간상세</th>';
                weekTable += '<th class="text-center">결재상태</th>';
                weekTable += '</tr>';
                weekTable += '</thead>';
                weekTable += '<tbody>';

                var weekGridStrtYy = $('#txt_weekStrtYy').text(); //현재 시작 년도
                var weekGridStrtMm = $('#txt_weekStrtMm').text()-1; //현재 시작 월
                var weekGridStrtDd = $('#txt_weekStrtDd').text(); //현재 시작 일

                var weekGridStrtDate = new Date(weekGridStrtYy, weekGridStrtMm, weekGridStrtDd); //시작 날짜

                for(var i = 0; i < 7; i++){

                    weekTable += '<tr>';
                    weekTable += '<td class="pt-3-half" contenteditable="false">'+weekGridStrtDate.getDate()+'</td>';
                    weekTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    weekTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    weekTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    weekTable += '<td class="pt-3-half" contenteditable="false">정상근무 :  / 초과근무 : </td>';
                    weekTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    weekTable += '</tr>';
                    weekGridStrtDate.setDate(weekGridStrtDate.getDate()+1);
                }

                weekTable += '</tbody>';
                weekTable += '</table>';

                document.getElementById('grid_week').innerHTML = weekTable;
            }

            /*********************************************************************
            *   Month Grid 생성
            *********************************************************************/
            function crteMonthGrid(){

                var monthTable = '<table class="table table-bordered table-responsive-md table-striped text-center">';
                monthTable += '<thead>';
                monthTable += '<tr>';
                monthTable += '<th class="text-center">일자</th>';
                monthTable += '<th class="text-center">업무시작시간</th>';
                monthTable += '<th class="text-center">업무종료시간</th>';
                monthTable += '<th class="text-center">총근무시간</th>';
                monthTable += '<th class="text-center">근무시간상세</th>';
                monthTable += '<th class="text-center">결재상태</th>';
                monthTable += '</tr>';
                monthTable += '</thead>';
                monthTable += '<tbody>';

                var monthGridStrtYy = $('#txt_mmYy').text(); //현재 시작 년도
                var monthGridStrtMm = $('#txt_mmMm').text()-1; //현재 시작 월

                var monthGridStrtDate = new Date(monthGridStrtYy, monthGridStrtMm, 1); //시작 날짜
                var tempMonthEndDate = new Date(monthGridStrtYy, monthGridStrtMm, 32); //다음 년도,월 세팅
                var monthEndDate = new Date(tempMonthEndDate.getFullYear(), tempMonthEndDate.getMonth(), 0); //종료 날짜

                for(var i = 0; i < monthEndDate.getDate(); i++){

                    monthTable += '<tr>';
                    monthTable += '<td class="pt-3-half" contenteditable="false">'+monthGridStrtDate.getDate()+'</td>';
                    monthTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    monthTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    monthTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    monthTable += '<td class="pt-3-half" contenteditable="false">정상근무 :  / 초과근무 : </td>';
                    monthTable += '<td class="pt-3-half" contenteditable="false"></td>';
                    monthTable += '</tr>';
                    monthGridStrtDate.setDate(monthGridStrtDate.getDate()+1);
                }

                monthTable += '</tbody>';
                monthTable += '</table>';

                document.getElementById('month_week').innerHTML = monthTable;
            }

            /*********************************************************************
            *   weekGridDtDfr Btn Click Event - 주 그리드 날짜 이전 버튼 클릭
            *********************************************************************/
            $('#btn_weekGridDtDfr').click(function(){

                console.log("weekGridDtDfr Btn Click Event");

                var dfrWeekEndYy = $('#txt_weekEndYy').text(); //현재 종료 년도
                var dfrWeekEndMm = $('#txt_weekEndMm').text()-1; //현재 종료 월
                var dfrWeekEndDd = $('#txt_weekEndDd').text(); //현재 종료 일

                var dfrWeekStrtYy = $('#txt_weekStrtYy').text(); // 현재 시작 년도
                var dfrWeekStrtMm = $('#txt_weekStrtMm').text()-1; //현재 시작 월
                var dfrWeekStrtDd = $('#txt_weekStrtDd').text(); // 현재 시작 일

                var dfrEndDate = new Date(dfrWeekEndYy, dfrWeekEndMm, dfrWeekEndDd); //현재 종료 날짜 등록

                var dfrStrtDate = new Date(dfrWeekStrtYy, dfrWeekStrtMm, dfrWeekStrtDd); //현재 시작 날짜 등록

                dfrEndDate.setDate(dfrEndDate.getDate()-7); //종료 날짜 이전 주
                dfrStrtDate.setDate(dfrStrtDate.getDate()-7); //시작 날짜 이전 주

                $('#txt_weekEndYy').text(dfrEndDate.getFullYear());
                $('#txt_weekEndMm').text(dfrEndDate.getMonth()+1);
                $('#txt_weekEndDd').text(dfrEndDate.getDate());

                $('#txt_weekStrtYy').text(dfrStrtDate.getFullYear());
                $('#txt_weekStrtMm').text(dfrStrtDate.getMonth()+1);
                $('#txt_weekStrtDd').text(dfrStrtDate.getDate());

                crteWeekGrid();
            });

            /*********************************************************************
            *   weekGridDtNxt Btn Click Event - 주 그리드 날짜 이후 버튼 클릭
            *********************************************************************/
            $('#btn_weekGridDtNxt').click(function(){

                console.log("weekGridDtNxt Btn Click Event");

                var nxtWeekEndYy = $('#txt_weekEndYy').text(); //현재 종료 년도
                var nxtWeekEndMm = $('#txt_weekEndMm').text()-1; //현재 종료 월
                var nxtWeekEndDd = $('#txt_weekEndDd').text(); //현재 종료 일

                var nxtWeekStrtYy = $('#txt_weekStrtYy').text(); //현재 시작 년도
                var nxtWeekStrtMm = $('#txt_weekStrtMm').text()-1; //현재 시작 월
                var nxtWeekStrtDd = $('#txt_weekStrtDd').text(); //현재 시작 일

                nxtEndDate = new Date(nxtWeekEndYy, nxtWeekEndMm, nxtWeekEndDd); //종료 날짜 다음 주
                nxtStrtDate = new Date(nxtWeekStrtYy, nxtWeekStrtMm, nxtWeekStrtDd); //시작 날짜 다음 주

                nxtEndDate.setDate(nxtEndDate.getDate()+7);
                nxtStrtDate.setDate(nxtStrtDate.getDate()+7);

                $('#txt_weekEndYy').text(nxtEndDate.getFullYear());
                $('#txt_weekEndMm').text(nxtEndDate.getMonth()+1);
                $('#txt_weekEndDd').text(nxtEndDate.getDate());

                $('#txt_weekStrtYy').text(nxtStrtDate.getFullYear());
                $('#txt_weekStrtMm').text(nxtStrtDate.getMonth()+1);
                $('#txt_weekStrtDd').text(nxtStrtDate.getDate());

                crteWeekGrid();
            });

            /*********************************************************************
            *   mmGridDtDfr Btn Click Event - 월 그리드 날짜 이전 버튼 클릭
            *********************************************************************/
            $('#btn_mmGridDtDfr').click(function(){

                console.log("mmGridDtDfr Btn Click Event");

                var txt_mmYyDfr = $('#txt_mmYy').text();
                var txt_mmMmDfr = $('#txt_mmMm').text()-2;
                var showMmGridDtDfr = new Date(txt_mmYyDfr, txt_mmMmDfr, 1); //날짜 이전 값 등록

                $('#txt_mmYy').text(showMmGridDtDfr.getFullYear()); //그리드 월tab 년도 이전 값 입력
                $('#txt_mmMm').text(showMmGridDtDfr.getMonth() + 1); //그리드 월tab 월 이전 값 입력

                crteMonthGrid();

            });

            /*********************************************************************
            *   mmGridDtNxt Btn Click Event - 월 그리드 날짜 이후 버튼 클릭
            *********************************************************************/
            $('#btn_mmGridDtNxt').click(function(){

                console.log("mmGridDtNxt Btn Click Event");

                var txt_mmYyDfr = $('#txt_mmYy').text();
                var txt_mmMmDfr = $('#txt_mmMm').text();
                var showMmGridDtDfr = new Date(txt_mmYyDfr, txt_mmMmDfr, 1); //날짜 이후 값 등록

                $('#txt_mmYy').text(showMmGridDtDfr.getFullYear()); //그리드 월tab 년도 이후 값 입력
                $('#txt_mmMm').text(showMmGridDtDfr.getMonth() + 1); //그리드 월tab 월 이후 값 입력

                crteMonthGrid();


            });

            /*********************************************************************
            *   Session Email 값 기준 현재일 포함 주 근무시간 조회
            *********************************************************************/
            var param = {
                "email" : 'ishwang@ingofen.co.kr'                                   // 추후 Session Value 연동.
            }

            $.ajaxCall( param, {
                 'method' : 'GET',
                 'url' : "{% url 'dili_api:getWrkTimeInfoByEml' %}",
                 'dataType' : 'json',
                 'data' : JSON.stringify(param),
                 'async' : false,
                 'callbackFn' : function(data, status, xhr){
                    console.log("data : ",data)
                    console.log("status : ",status)
                    console.log("xhr : ",xhr)

                    // 해당 근무시간을 데이터로 차트를 그린다.
                    drawChart(34,7,9.4);
                 }
            });

            /*********************************************************************
            *   Session Email 값 기준 연차정보 조회
            *********************************************************************/
            $.ajaxCall( param, {

                 'method' : 'GET',
                 'url' : "{% url 'dili_api:getYryMgmt' %}",
                 'dataType' : 'json',
                 'data' : JSON.stringify(param),
                 'async' : false,
                 'callbackFn' : function(data){

                    console.log("data : ",data)

                    $('#txt_allAnhoDays').text(data[0].ALL_YRY_DAYS) //전체연차일수
                    $('#txt_rmnAnhoDays').text(data[0].ALL_YRY_DAYS - data[0].USE_YRY_DAYS) //남은연차일수
                 }
            });

            /*********************************************************************
            *   Grid Btn Click Event - 그리드 버튼 클릭
            *********************************************************************/
            $('#btn_showGrd').click(function(){

                console.log("Grid Btn Click Event");

                $('#grp_grid').show('');
                $('#grp_calendar').hide();
            });

            /*********************************************************************
            *   Calendar Btn Click Event - 캘린더 버튼 클릭
            *********************************************************************/
            $('#btn_showCal').click(function(){

                console.log("Calendar Btn Click Event");

                $('#grp_grid').hide();
                $('#grp_calendar').show('');
            });
            /*********************************************************************
            *   Week Btn Click Event - 주 버튼 클릭
            *********************************************************************/
            $('#btn_showWeek').click(function(){

                console.log("Week Btn Click Event");

                $('#grp_showWeek').show('');
                $('#grp_showMonth').hide();
            });

            /*********************************************************************
            *   Month Btn Click Event - 월 버튼 클릭
            *********************************************************************/
            $('#btn_showMonth').click(function(){

                console.log("Month Btn Click Event");

                $('#grp_showWeek').hide();
                $('#grp_showMonth').show('');
            });

            /*********************************************************************
            *   anhoReg Btn Click Event - 연차등록 버튼 클릭
            *********************************************************************/
            $('#btn_anhoReg').on('click', function() {

                modal('my_modal');                  //연차결제 화면 모달 띄우기
                $("#my_modal2").load("{% url 'dili_api:yryApvlReq' %}");


            });

            /*********************************************************************
            *   btn_datepicker Btn Click Event - 일달력호출
            *********************************************************************/
            $('#btn_datepicker').click(function(){

                 $('#datepickerData').datepicker('show');
            });

            /*********************************************************************
            *   클릭한 달력 datepickerData에 value 값 담기
            *********************************************************************/
            $("#datepickerData").datepicker({

                onSelect:function(dateText, inst) {

                    var tempData = $('#datepickerData').val().split('-');
                    var selectDatepickerDate = new Date(tempData[0], Number(tempData[1])-1, tempData[2]);

                    //날짜 세팅
                    year = selectDatepickerDate.getFullYear(); // 년도
                    month = selectDatepickerDate.getMonth();  // 월 (today.getMonth()는 0~11로 출력)
                    date = selectDatepickerDate.getDate();  // 날짜
                    day = selectDatepickerDate.getDay();  // 요일 (0~6으로 출력, 0:일요일, 1:월요일, 6:토요일)
                    crteTodayShow(year, month, date, day);
                }
	        });

	        /*********************************************************************
            *   btn_monthpicker Btn Click Event - 월달력호출
            *********************************************************************/
            $('#btn_monthpicker').bind('click', function(){

               $('#monthpickerData').monthpicker('show');
            });

            /*********************************************************************
            *   클릭한 달력monthpickerData에 value 값 담기
            *********************************************************************/
            $('#monthpickerData').monthpicker().bind('monthpicker-click-month', function (e, month) {

                    var tempMonthpickerData = $('#monthpickerData').val().split('-');
                    var selectMonthpickerData = new Date(tempMonthpickerData[0], Number(tempMonthpickerData[1])-1, 1);

                    $('#txt_mmYy').text(selectMonthpickerData.getFullYear()); //그리드 월tab 년도 값 입력
                    $('#txt_mmMm').text(selectMonthpickerData.getMonth() + 1); //그리드 월tab 월 값 입력
            });

            /*********************************************************************
            *   search Btn Click Event - 검색 버튼 클릭
            *********************************************************************/
            $('#searchBtn').click(function(){

                var name = $('#ipt_searchName').val();
                alert("이름["+name+"]기준 직원조회 팝업 호출 연동하기.");                   //직원 조회 화면으로 Name값 전달
            });


            /*********************************************************************
            *   ipt_searchName EnterKey Event - 직원 조회 엔터키 이벤트
            *********************************************************************/
            $('#ipt_searchName').keydown(function(e){

                //엔터키 입력 + 이름컬럼에 값이 있는 경우.
                if ( e.keyCode == 13 && $('#ipt_searchName').val() != 'undefined' && $('#ipt_searchName').val() != "" ) {
                    var name = $('#ipt_searchName').val();
                    alert("이름["+name+"]기준 직원조회 팝업 호출 연동하기.")
                }
            });

            /*********************************************************************
            *   Draw  calendar Event - 캘린더 API 그리기
            *********************************************************************/
            var calendar = new tui.Calendar(document.getElementById('calendar'), {
                defaultView: 'month',
                taskView: true,
                useCreationPopup: true,
                useDetailPopup: true
            });



            /*********************************************************************
            *   Draw  calendar Event - 데이터 받아오기
            *********************************************************************/
            var param = {
                "email" : 'test'
            }

            $.ajaxCall( param, {
                 'method' : 'GET',
                 'url' : "{% url 'dili_api:getCalendarData' %}",
                 'dataType' : 'json',
                 'data' : JSON.stringify(param),
                 'async' : false,
                 'callbackFn' : function(data, status, xhr){
                    console.log("data111 : ",JSON.parse(data))

                    setCalendar(data);
                 }
            });

            /*********************************************************************
            *   Draw  calendar Event - 받아온 데이터 캘린더에 입력
            *********************************************************************/
            function setCalendar(data){
                var calendarData = JSON.parse(data);
                console.log("calendarData1 : ",calendarData);

                console.log("JOB_STRT_TM : ",calendarData[0].JOB_STRT_TM);
                console.log("JOB_END_TM : ",calendarData[0].JOB_END_TM);



                var dataCustomArray = new Array();

                for(var i=0; i < calendarData.length; i++) {
                    var dataCustom = [{
                        calendarId: i,
                        id: String(Math.random() * 100000000000000000),
                        title : "업무시작시간: " + calendarData[i].JOB_STRT_TM,
                        isAllDay: false,
                        start: new Date(calendarData[i].JOB_STRT_TM),
                        end: new Date(calendarData[i].JOB_END_TM),
                        category: "time"
                    }, {
                        calendarId: i + 1,
                        id: String(Math.random() * 100000000000000000),
                        title : "업무종료시간: " + calendarData[i].JOB_END_TM,
                        isAllDay: false,
                        start: new Date(calendarData[i].JOB_STRT_TM),
                        end: new Date(calendarData[i].JOB_END_TM),
                        category: "time"
                    }];

                    dataCustomArray.push(dataCustom);
                }

                console.log("dataCustomArray : ",dataCustomArray);

                calendar.createSchedules(dataCustomArray);
            }


            /*********************************************************************
            *   Draw  calendar Event - 캘린더 색입히기
            *********************************************************************/
            calendar.setCalendarColor('1', {
                color: '#e8e8e8',
                bgColor: '#585858',
                borderColor: '#a1b56c',
                dragBgColor: '#585858',
            });
            calendar.setCalendarColor('2', {
                color: '#282828',
                bgColor: '#dc9656',
                borderColor: '#a1b56c',
                dragBgColor: '#dc9656',
            });


            /*********************************************************************
            *  저장, 수정, 삭제 이벤트
            *********************************************************************/
            calendar.on("beforeCreateSchedule", function(scheduleData){
              var schedule = {
                calendarId: scheduleData.calendarId,
                id: String(Math.random() * 100000000000000000),
                title: scheduleData.title,
                isAllDay: scheduleData.isAllDay,
                start: scheduleData.start,
                end: scheduleData.end,
                category: scheduleData.isAllDay ? 'allday' : 'time',
                location: scheduleData.location             // 장소 정보
              };
              // ajax DB 저장 schedule
              // DB 저장
              calendar.createSchedules([schedule]);
              console.log(schedule);
            });



            /*********************************************************************
            *   calendar 버튼제어 - today,이전날 다음달
            *********************************************************************/
            setLabel(calendar);

            $("#today").click(function(){
              calendar.today();
              setLabel(calendar);
            });
            $("#prev").click(function(){
              calendar.prev();
              setLabel(calendar);
            });
            $("#next").click(function(){
              calendar.next();
              setLabel(calendar);
            });

            function setLabel(calendar){
              $("#calendarLabel").text(calendar.getDate().getFullYear() + "." + (calendar.getDate().getMonth()+1));
            }

            /*********************************************************************
            *   calendar Click Event - calender 클릭시
            *********************************************************************/
            $('#calendar').click(function(event){
<!--                console.log('calendarClick', event.date, event.target);-->



            });



        });<!--ready.function_END-->

        /*********************************************************************
        *   Draw Chart Event - 근무누적시간 누적막대그래프 그리기
        *   nmlWrkTime      - 정상근무시간
        *   aprvWrkTime     - 초과근무시간(승인)
        *   notAprvWrkTime  - 초과근무시간(미승인)
        *********************************************************************/
        function drawChart(nmlWrkTime, aprvWrkTime, notAprvWrkTime) {

            var arr = [nmlWrkTime, aprvWrkTime, notAprvWrkTime]

            var barOptions_stacked = {
                title: {
                    display: true,
                    text: '총 근무시간 : ' + (nmlWrkTime + aprvWrkTime + notAprvWrkTime) + 'H',
                    fontSize: 15,
                    padding: 0
                },
                tooltips: {
                    enabled: false
                },
                hover :{
                    animationDuration:0
                },
                scales: {
                    xAxes: [{
                        ticks: {
                            beginAtZero:true,
                            display:false,
                            max : 52
                        },
                        scaleLabel:{
                            display:false
                        },
                        gridLines: {
                            display:false
                        },
                        stacked: true
                    }],
                    yAxes: [{
                        gridLines: {
                            display:false,
                            color: "#fff",
                            zeroLineColor: "#fff",
                            zeroLineWidth: 0
                        },
                        stacked: true
                    }]
                },
                legend:{
                    display:true,
                    position : 'right',
                    fontColor: 'rgb(255, 99, 132)'
                },

                animation: {
                    onComplete: function () {
                        var chartInstance = this.chart;
                        var ctx = chartInstance.ctx;
                        ctx.textAlign = "left";
                        ctx.font = "13px Open Sans";
                        ctx.fillStyle = "#fff";

                        Chart.helpers.each(this.data.datasets.forEach(function (dataset, i) {
                            var meta = chartInstance.controller.getDatasetMeta(i);
                            Chart.helpers.each(meta.data.forEach(function (bar, index) {
                                data = dataset.data[index];
                                if( i==0 && arr[i] >= 1){
                                    ctx.fillText(data, bar._model.x-25 - (bar._model.x * 0.5)+20, bar._model.y+1);
                                } else if ( i >0 && arr[i] >= 1){
                                    ctx.fillText(data, bar._model.x-25 - ( (bar._model.x - bar._model.base ) * 0.5)+20, bar._model.y+1);
                                }
                            }),this)
                        }),this);
                    }
                },
                responsive : true,
                maintainAspectRatio: false,
                pointLabelFontFamily : "Quadon Extra Bold",
                scaleFontFamily : "Quadon Extra Bold",
            };

            var ctx = document.getElementById("Chart1");

            var myChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    datasets: [{
                        label: "정상근무 : " + nmlWrkTime + "H",
                        data: [nmlWrkTime],
                        backgroundColor: "rgba(63,103,126,1)",
                        hoverBackgroundColor: "rgba(50,90,100,1)",
                        barPercentage: 0.4
                    },{
                        label: "초과근무(승인) : " + aprvWrkTime + "H",
                        data: [aprvWrkTime],
                        backgroundColor: "rgba(163,103,126,1)",
                        hoverBackgroundColor: "rgba(140,85,100,1)",
                        barPercentage: 0.4
                    },{
                        label: "초과근무(미승인) : " + notAprvWrkTime + "H",
                        data: [notAprvWrkTime],
                        backgroundColor: "rgba(63,203,226,1)",
                        hoverBackgroundColor: "rgba(46,185,235,1)",
                        barPercentage: 0.4
                    }]
                },
                options: barOptions_stacked,
            });
        }

    </script>

        <!--모달 영역 -->
        <div id="my_modal" class="modalUi">
            <div id="my_modal2">
            </div>
            <a class="modal_close_btn">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                   <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                   <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </a>
        </div>



        <div class="row">
            <div class="col-sm-12">
                <div class="mb-4" role="alert">
                    <h5>
                        <b>근무시간관리</b>
                    </h5>
                </div>

                <!-- 1. 사원 조회영역 -->
                <div class="accordion mb-4" id="grp_search">
                    <div class="card">
                        <div class="card-header p-0" id="head_search">
                            <h2 class="mb-0">
                                <button class="btn btn-link btn-block text-left text-dark" type="button" data-toggle="collapse" data-target="#col_search" aria-expanded="true" aria-controls="collapseOne">
                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                                    </svg>
                                    직원조회
                                </button>
                            </h2>
                        </div>
                        <div id="col_search" class="collapse show" aria-labelledby="head_search" data-parent="#grp_search">
                            <div class="card-body flex-height d-flex m-0 p-2">
                                <div class="align-self-start align-self-center mr-3">성명</div>
                                <div class="align-self-center mr-3">
                                    <input type="text" class="form-control" id="ipt_searchName" name="ipt_searchName" placeholder="이름을 입력해주세요." maxlength="10"/>
                                </div>
                                <div class="align-self-end align-self-center">
                                    <button class="btn btn-primary" id="searchBtn">Search</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. 사원 누적근무시간 영역 -->
                <div class="accordion mb-4" id="grp_totWrkTime">
                    <div class="card">
                        <div class="card-header p-0" id="head_totWrkTime">
                            <h2 class="mb-0">
                                <button id="btn_acdTotWrkTime" class="btn btn-link btn-block text-left text-dark" type="button" data-toggle="collapse" data-target="#col_totWrkTime" aria-expanded="true" aria-controls="collapseOne">
                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                                    </svg>
                                    누적근무시간
                                </button>
                            </h2>
                        </div>
                        <div id="col_totWrkTime" class="collapse show" aria-labelledby="head_totWrkTime" data-parent="#grp_totWrkTime">
                            <div class="mt-3" style="width:100%;">
                                <div class="chart-container" style="display:block; width:100%; height:120px;">
                                    <canvas id="Chart1"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex flex-row-reverse">
                    <div>
                        <button type="button" id="btn_showGrd">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-card-list" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M14.5 3h-13a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                              <path fill-rule="evenodd" d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z"/>
                              <circle cx="3.5" cy="5.5" r=".5"/>
                              <circle cx="3.5" cy="8" r=".5"/>
                              <circle cx="3.5" cy="10.5" r=".5"/>
                            </svg>
                        </button>
                    </div>
                    <div>
                        <button type="button" id="btn_showCal">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-calendar3" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z"/>
                              <path fill-rule="evenodd" d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                            </svg>
                        </button>
                    </div>
                    <!-- 연차등록 버튼 -->
                    <div style="margin-right: 20px;">
                        <button type="button" class="badge badge-danger" id="btn_anhoReg">연차등록</button>
                    </div>
                    <!-- 전체연차일수/ 남은연차일수 표기 -->
                    <div style="margin-right: 20px;">
                        <span>전체연차일수 : </span>
                        <span id="txt_allAnhoDays">0</span>
                        <span> / 남은연차일수 : </span>
                        <span id="txt_rmnAnhoDays">0</span>
                    </div>
                </div>

                <!-- 3. 사원 Schedule Grid 영역 -->
                <div id="grp_grid">
                    <div class="p-5">
                        <div class="d-flex flex-row-reverse">
                            <div>
                                <span class="badge badge-success" id="btn_showMonth">Month</span>
                            </div>
                            <div>
                                <span class="badge badge-warning" id="btn_showWeek">Week</span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center" style="height:0; visibility:hidden;">
                            <input type="text" name="date" id="monthpickerData" />
                        </div>
                        <!-- 3-1. 사원 Schedule Grid 영역 주단위 -->
                        <div id="grp_showWeek">
                            <div class="d-flex justify-content-center mb-5">
                                <button type="button" id="btn_weekGridDtDfr">
                                    <svg width="0.6em" height="0.6em" viewBox="0 0 16 16" class="bi bi-caret-left-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.86 8.753l5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                                    </svg>
                                </button>
                                <input type="hidden" name="date" id="datepickerData"/>
                                <div id="btn_datepicker" style="margin-right: 10px;margin-left: 10px;">
                                    <h5>
                                        <span id="txt_weekStrtYy"></span>
                                        <span>.</span>
                                        <span id="txt_weekStrtMm"></span>
                                        <span>.</span>
                                        <span id="txt_weekStrtDd"></span>
                                        <span> - </span>
                                        <span id="txt_weekEndYy"></span>
                                        <span>.</span>
                                        <span id="txt_weekEndMm"></span>
                                        <span>.</span>
                                        <span id="txt_weekEndDd"></span>
                                    </h5>
                                </div>
                                <button type="button" id="btn_weekGridDtNxt">
                                    <svg width="0.6em" height="0.6em" viewBox="0 0 16 16" class="bi bi-caret-right-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                                    </svg>
                                </button>
                            </div>

                            <!--week table 영역 -->
                            <div id="grid_week"></div>
                        </div>
                        <!-- 3-2. 사원 Schedule Grid 영역 월단위 -->
                        <div id="grp_showMonth">

                            <div class="d-flex justify-content-center mb-5">
                                <button type="button" id="btn_mmGridDtDfr">
                                    <svg width="0.6em" height="0.6em" viewBox="0 0 16 16" class="bi bi-caret-left-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.86 8.753l5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                                    </svg>
                                </button>

                                <div id="btn_monthpicker" style="margin-right: 10px;margin-left: 10px;">
                                    <h5>
                                        <span id="txt_mmYy"></span>
                                        <span>.</span>
                                        <span id="txt_mmMm"></span>
                                    </h5>
                                </div>
                                <button type="button" id="btn_mmGridDtNxt">
                                    <svg width="0.6em" height="0.6em" viewBox="0 0 16 16" class="bi bi-caret-right-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                                    </svg>
                                </button>
                            </div>
                            <!--week table 영역 -->
                            <div id="month_week"></div>
                        </div>

                    </div>
                </div>
                <!-- 4. 사원 Schedule Calendar 영역 -->
                <div id="grp_calendar">
                    <div class="bg-light p-5">
                        <div id="menu">
                            <span id="menu-navi">
                              <button type="button" class="btn btn-outline-primary btn-sm" id="today">Today</button>
                              <button type="button" class="btn btn-outline-secondary btn-sm" id="prev">이전달</button>
                              <button type="button" class="btn btn-outline-secondary btn-sm" id="next">다음달</button>
                              <span id="calendarLabel"></span>
                            </span>
                            <span id="renderRange" class="render-range"></span>
                        </div>
                        <div id="calendar"></div>
                    </div>
                </div>



            </div>
        </div>
    </div>

{% endblock %}