    <script type="text/javascript">
    /*********************************************************************
    *   Dialog Setting
    *********************************************************************/
    var n_dialog = new ax5.ui.dialog();
    var n_title =  '<span style="color:#fd7e14;font-size:20px;"><i class="fa fa-check-circle"></i></span> CHECK';

    n_dialog.setConfig({
        title: n_title,
        theme : 'info',
        lang:{
            "ok": "확인", "cancel": "취소"
        }
    });

    /*********************************************************************
    *   Session Email 값 기준 연차정보 조회
    *********************************************************************/
    function setAnhoMgmt(){
        var param = {
            "email" : sessionStorage.getItem("email")
        }

        $.ajaxCall( param, {
             'method' : 'GET',
             'url' : "{% url 'dili_api:getYryMgmt' %}",
             'dataType' : 'json',
             'data' : JSON.stringify(param),
             'async' : false,
             'callbackFn' : function(data){
             debugger;
                if(data.length > 0){
                    $('#txt_allAnhoDays').text(data[0].ALL_YRY_DAYS)                        //전체연차일수
                    $('#txt_rmnAnhoDays').text(data[0].ALL_YRY_DAYS - data[0].USE_YRY_DAYS) //남은연차일수

                }else {

                    $('#txt_allAnhoDays').text(0)                                           //전체연차일수
                    $('#txt_rmnAnhoDays').text(0)                                           //남은연차일수
                }
             }
        });
    }



    $(document).ready(function(){
        //결재 소제목 지정
        if($('input:radio[name="APVL_REQ_DIVS_CD"]:checked').val() == '03') {
            $('#apvlReqTit').html("<b>연차 사용 결재 요청</b>");

        }

        // 공통 코드 조회 - '신청구분'
        retrieveCmmCd("rb_apvlReqKdCd", 'APVL_REQ_KD_CD');
        // 공통 코드 조회 - '휴가종류'
        retrieveCmmCd("rb_ptoKdCd", 'PTO_KD_CD');

        // 남은 연차, 총 연차 조회
        setAnhoMgmt();


        /*********************************************************************
        *   남은 연차 조회
        *********************************************************************/
/*
        var param = {
            "email" : sessionStorage.getItem("email")
        }

        $.ajaxCall( param, {
            'method' : 'GET',
            'url' : "{% url 'dili_api:getYryUseDays' %}",
            'dataType' : 'json',
            'data' : JSON.stringify(param),
            'async' : false,
            'callbackFn' : function(data){

            // 리턴
            useYryYn(data);
            }
        });
*/
        function useYryYn(data) {
            if(data[0].USE_YRY_YN == 'N') {
                $('#exitSchdModal').click();
            }
        }

        /*********************************************************************
        *   btn_datepicker1 Btn Click Event - 일달력호출
        *********************************************************************/
        $("#btn_datepicker1").click(function(){

            $("#datepickerData1").datepicker("show");
        });

        /*********************************************************************
        *   btn_datepicker2 Btn Click Event - 일달력호출
        *********************************************************************/
        $("#btn_datepicker2").click(function(){
            if($("#ipt_holiTerm1").val() == "") {
                alert("시작 일자를 먼저 선택해주세요.");
                return;
            }
            $("#datepickerData2").datepicker("show");
        });

        /*********************************************************************
        *   클릭한 달력 datepickerData1에 value 값 담기
        *********************************************************************/
        $("#datepickerData1").datepicker({
            onSelect:function(dateText, inst) {

                var tempData = $('#datepickerData1').val();

                $("#ipt_holiTerm2").val("");
                $("#ipt_holiTerm1").val(tempData);
            }
        });

        /*********************************************************************
        *   클릭한 달력 datepickerData2에 value 값 담기
        *********************************************************************/
        $("#datepickerData2").datepicker({

            onSelect:function(dateText, inst) {

                var tempData = $('#datepickerData2').val();

                $("#ipt_holiTerm2").val(tempData);
                dateCalcu();
            }
        });

        function dateCalcu() {
            var tempData1 = $("#ipt_holiTerm1").val().split('-');
            var tempData2 = $("#ipt_holiTerm2").val().split('-');

            var arrDate1 = new Date(tempData1[0], tempData1[1], tempData1[2]);
            var arrDate2 = new Date(tempData2[0], tempData2[1], tempData2[2]);

            var diffDate = arrDate2 - arrDate1;
            var currDate = 24 * 60 * 60 * 1000;

            if(parseInt(diffDate/currDate)+1 < 0) {
                alert("시작일자와 종료일자를 다시 확인해주세요.");
                $("#ipt_holiTerm2").val("");
                return;
            } else {
                $("#ipt_holiDays").val(parseInt(diffDate/currDate)+1);
            }

        }

    });
/*
    $(document).on("change","input:radio[name='APVL_REQ_MTHD_CD']",function(){
            console.log("동적컴포넌트::onchange");
            var url = "";
            if($("input[name='APVL_REQ_MTHD_CD']:checked").val() == '01') {
                url = "{% url 'dili_api:apvlReqPop' %}" ;
            } else if($("input[name='APVL_REQ_MTHD_CD']:checked").val() == '02') {
                url = "{% url 'dili_api:yryApvlReq' %}" ;
            } else if($("input[name='APVL_REQ_MTHD_CD']:checked").val() == '03') {
                url = "{% url 'dili_api:wrkApvlReq' %}" ;
            }
            $('#testDi2v').load(url);
    });
*/
    function btnReqEvt2() {
        if($('input[name="reqType"]:checked').val() == "") {
            alertMsg("결재 구분을 선택해주세요.");
            return;
        }

        if($("#ipt_holiTerm1").val() == "") {
            alertMsg("휴가기간을 선택해주세요.");
            return;
        }

        if($("#txa_holiRsn").val() == "") {
            alertMsg("휴가사유를 입력해주세요.");
            return;
        }

        if($("#ipt_emerCtpl").val() == "") {
            alertMsg("비상연락망을 입력해주세요.");
            return;
        }

        n_dialog.confirm('저장하시겠습니까?',function(){
            if(this.key == 'ok'){
                if(Number($('#txt_rmnAnhoDays').text()) == 0){
                    alertMsg("남은연차가 없습니다.");
                    return;
                }
                if(Number($('#txt_rmnAnhoDays').text()) < Number($('#ipt_holiDays').val())){
                    alertMsg("남은연차일수 보다 등록하실 연차일수가 더 큽니다.");
                    return;
                }
                var param = [];

                var tmpParam = {
                    "email" : sessionStorage.getItem("email"),
                    "apvlReqDivs" : $('input[name="reqType"]:checked').val(),    //01: 선결재, 02: 후결재//////////////////////////////수정
                    "wrkDt" : $("#ipt_holiTerm1").val(),
                    "wrkTme" : "000000",
                    "wrkReqRsn": $("#txa_holiRsn").val(),
                    "th1AprvStus": "01",
                    "th1AprvNm": "hykim@infogen.co.kr",
                    "th2AprvStus": "01",
                    "th2AprvNm": "yblee1987@infogen.co.kr",
                    "holiDays" : $("#ipt_holiDays").val(),
                    "emerCtpl" : $("#ipt_emerCtpl").val()

                }

                param.push(tmpParam);

                if($("#ipt_holiDays").val()-1 > 0) {
                    var date = new Date($("#ipt_holiTerm1").val().substring(0,4), $("#ipt_holiTerm1").val().substring(5,7)-1,$("#ipt_holiTerm1").val().substring(8,10));
                    for(var i=0; i<$("#ipt_holiDays").val()-1; i++) {

                        date.setDate(date.getDate() + 1)

                        var tmpParam = {
                            "email" : sessionStorage.getItem("email"),
                            "apvlReqDivs" : $('input[name="reqType"]:checked').val(),    //01: 선결재, 02: 후결재//////////////////////////////수정
                            "wrkDt" : setWeek(date).baseDate,
                            "wrkTme" : "000000",
                            "wrkReqRsn": $("#txa_holiRsn").val(),
                            "th1AprvStus": "01",
                            "th1AprvNm": "hykim@infogen.co.kr",
                            "th2AprvStus": "01",
                            "th2AprvNm": "yblee1987@infogen.co.kr",
                            "holiDays" : $("#ipt_holiDays").val(),
                            "emerCtpl" : $("#ipt_emerCtpl").val()

                        }
                        param.push(tmpParam);
                    }
                }
                $.ajaxCall( param, {
                     method : 'POST',
                     'url' : '/dili/saveYryApvlReq/post',
                     'dataType' : 'json',
                     'data' : JSON.stringify(param),
                     'async' : false,
                     'callbackFn' : function(data){

                        // 리턴
                        g_toast.push('저장 되었습니다.');
                        $('#exitSchdModal').click();
                     }
                });
            }
        });
    }

    </script>
<div class="row">
    <div class="col-sm-12">
            <div class="accordion mb-4" id="grp_yryApvlReq">
                <div class="mb-4" role="alert">
                    <!-- Title -->
                    <h6 id="apvlReqTit">
                        <b>근무결재 요청</b>
                    </h6>
                </div>

                <div class="p-0" id="head_yryApvlReq">

                    <!-- Body -->
                    <div id="col_yryApvlReq" class="collapse show" aria-labelledby="head_yryApvlReq" data-parent="#grp_yryApvlReq">
                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-3">신청구분</div>
                            <div class="align-self-center mr-5">
                                <input id="rb_apvlReqKdCd" type="radio" name="APVL_REQ_KD_CD" value="00" style="display : none;">
                            </div>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-3">휴가종류</div>
                           <div class="align-self-center mr-5">
                                <input id="rb_ptoKdCd" type="radio" name="PTO_KD_CD" value="00" style="display : none;">
                            </div>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-3">휴가기간</div>
                            <input type="hidden" name="date" id="datepickerData1"/>
                            <div id="btn_datepicker1" class="align-self-center mr-5" >
                                <input type="text" class="form-control" id="ipt_holiTerm1" name="ipt_holiTerm" placeholder="" maxlength="24"/>
                            </div>
                            ~
                            <input type="hidden" name="date" id="datepickerData2"/>
                            <div id="btn_datepicker2" class="align-self-center mr-5" >
                                <input type="text" class="form-control" id="ipt_holiTerm2" name="ipt_holiTerm" placeholder="" maxlength="24"/>
                            </div>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-3">휴가일수</div>
                            <div class="align-self-center mr-5">
                                <input type="text" class="form-control" id="ipt_holiDays" name="ipt_holiDays" maxlength="4" readonly/>
                            </div>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-5">사유</div>
                            <!--
                            <div class="align-self-center mr-5">
                                <textarea id="txa_holiRsn" name="holiRsn" maxlength="500" placeholder="휴가 사유를 입력해주세요."></textarea>
                            </div>
                            -->
                            <div class="align-self-center mr-7">
                                <textarea id="txa_holiRsn" name="reqRsn" maxlength="500" style="resize: none; width:350px;height:70px;" placeholder="휴가 사유를 입력해주세요."></textarea>
                            </div>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-2">비상연락망</div>
                            <div class="align-self-center mr-5">
                                <input type="text" class="form-control" id="ipt_emerCtpl" name="ipt_emerCtpl" placeholder="01012345678" maxlength="11"/>
                            </div>
                        </div>

                        <!-- 남은 연차 일수 / 총 연차 일수 표기 -->
                        <div class="flex-height d-flex m-0 p-2"><!--style="margin-right: 20px;">-->
                            <span> 남은 연차 일수 :&nbsp;</span>
                            <span id="txt_rmnAnhoDays">0</span>
                            <span>&nbsp;일 / 총 연차 일수 :&nbsp;</span>
                            <span id="txt_allAnhoDays">0</span>
                            <span>&nbsp;일</span>
                        </div>

                        <div class="flex-height d-flex m-0 p-2">
                            <div class="align-self-start align-self-center mr-3"></div>
                            <div class="align-self-center mr-7">
                                <button type="button" class="button" id="btn_req" onclick="btnReqEvt2()">요청</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

