{% extends 'common/base.html' %}

{% block content %}


 <style>
#modal {
<!--  display:none;-->
  position:relative;
  width:100%;
  height:100%;
  z-index:1;
}

#modal h2 {
  margin:0;
}

#modal input {
  width:100%;
  border: 0;
  border-bottom: 1px solid #0489B1;
  outline : 0;
}

#modal button {
  display:inline-block;
  width:33%;
  margin-center:calc(100% - 100px - 10px);
  float:right;
  color: blue;
  background-color: rgba(0,0,0,0);
  border: 0;
  outline : 0;

}

#modal .modal_content {
  width:600px;
  margin:100px auto;
  padding:0px 40px;
  background:#fff;
  border:2px solid #666;
}

#modal .modal_layer {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgb(0, 0, 0, 0.5);
  z-index:-1;
}

tbody>tr {
  counter-increment: aaa;
}
tbody>tr>td:first-child:before {
  content: counter(aaa) " ";
}

</style>


<div id="modal">

    <div class="modal_content">
            <h2 style = "font-weight:bold"><U>프로젝트 상세 관리</U></h2><br>
        <div id = "projectInfo">
            <span style="color: #0489B1;
                         font-size: 1.0em;
                         padding:20px;">

                <p style = "display:none">프로젝트 코드<br>
                    <input type = "text" id = "prj_cd" name = "prj_cd"></p>

                <p>*프로젝트 명<br>
                    <input type = "text" id = "prj_nm" name = "prj_nm" placeholder="input text"></p>

                <p>*고객사 계약 코드<br>
                    <input type = "text" id = "cnct_cd" name = "cnct_cd" placeholder="input text"></p>

                <p>*원청사<br>
                    <input type = "text" id = "gnr_ctro" name = "gnr_ctro" placeholder="input text"></p>

                <p>*계약사<br>
                    <input type = "text" id = "ctro" name = "ctro" placeholder="input text"></p>

                <p>계약 금액<br>
                    <input type = "text" id = "cnct_amt" name = "cnct_amt" placeholder="input text"></p>

                <p>*매출 사업부<br>
                    <select size ="1" style="width:200px" id = "slin_bzdp" name = "slin_bzdp" class="col-sm-2">
                        <option>선택</option>
                        <option value = "01">FIC</option>
                        <option value = "02">전자/제조</option>
                        <option value = "03">통신</option>
                        <option value = "04">화학</option>
                        <option value = "05">전략</option>
                        <option value = "06">DX</option>
                    </select>
                </p>

                <p>*업무 구분<br>
                    <select size ="1" style="width:200px" id = "job_divs" name = "job_divs" class="col-sm-2">
                        <option>선택</option>
                        <option value = "01">SM</option>
                        <option value = "02">SI</option>
                    </select>
                </p>

                <p>*진행 상태<br>
                    <select size ="1" style="width:200px" id = "pgrs_stus" name = "pgrs_stus" class="col-sm-2">
                        <option>선택</option>
                        <option value = "01">예정</option>
                        <option value = "02">진행 중</option>
                        <option value = "03">종료</option>
                    </select>
                </p>

                <p>비고<br>
                    <input type = "text" id = "rmks" name = "rmks" placeholder="input text"></p>
                <br>
                요구스킬  <button id = "addStaff" name="addStaff" class = "btn btn-primary style="float:right">추가</button>
                <table id="reqSkil" class="table" style="margin-top: 20px;">
                    <colgroup>
                        <col width="20%"/>
                        <col width="30%"/>
                        <col width="35%"/>
                        <col width="15%"/>
                    </colgroup>

                    <thead>
                    <tr style = "float : center">
                        <th>순번</th>
                        <th>구분</th>
                        <th>스킬명</th>
                        <th></th>
                    </tr>
                    </thead>

                    <tbody id="reqSkilBody" name = "req_skil">
                        <tr name="trSkil">
                            <td id="staff_name"></td>
                            <td><select size="1" class="form-control" id="req_skil_divs1" name="req_skil_divs1" onchange="skil_chg(1)">
                                <option value = "00">선택</option>
                                <option value = "01">DB</option>
                                <option value = "02">LANGUAGE</option>
                                <option value = "03">WEB</option>
                                <option value = "04">MIDWARE</option>
                                <option value = "05">Framework</option>
                            </select></td>
                            <td><select class="form-control" id = "req_skil_name1" name = "req_skil_name1"></select></td>
                        </tr>
                    </tbody>
                </table>

                <p style = "display:none">trCount<br>
                    <input type = "text" id = "trCount" name = "trCount"></p>
            </span>
        </div>

        <hr>
            <button type="button" id="modal_delete_btn" style="color:red">삭제</button>
            <button type="button" id="modal_save_btn">저장</button>
            <button type="button" id="modal_close_btn">취소</button>
        <br>
     
    </div>

    <div class="modal_layer"></div>
</div>

<script>

    $(document).ready(function() {
       $('#prj_cd').val('PRJ_000010');
       var prj_cd = $('#prj_cd').val();

       if(prj_cd != null){
           console.log('prj_cd is not null');
           retrievePrjInfo();
           retrieveReqSkil();
       } else{
           console.log('prj_cd is null');
       }
    });

    function retrievePrjInfo(){
        $('#projectInfo').ajaxCall({
            method : 'GET',
            url : "{% url 'skil_api:retrievePrjInfo' %}",
            callbackFn : function(data){
                $('#prj_nm').val(data[0].PRJ_NAME);
                $('#cnct_cd').val(data[0].PRJ_CNCT_CD);
                $('#gnr_ctro').val(data[0].GNR_CTRO);
                $('#ctro').val(data[0].CTRO);
                $('#cnct_amt').val(data[0].CNCT_AMT);
                $('#slin_bzdp').val(data[0].SLIN_BZDP);
                $('#job_divs').val(data[0].JOB_DIVS_CD);
                $('#pgrs_stus').val(data[0].PGRS_STUS_CD);
                $('#rmks').val(data[0].RMKS);

            }
        });
    };

    function retrieveReqSkil(){
        $('#projectInfo').ajaxCall({
            method : 'GET',
            url : "{% url 'skil_api:retrieveReqSkil' %}",
            callbackFn : function(data){
                var length = data.length;
                for(var i=0; i<length; i++){
                    if(i != length-1){
                        $("#addStaff").trigger("click");
                    }
                    $('#req_skil_divs'+(i+1)).val(data[i].SKIL_DIVS).trigger('change');
                    $('#req_skil_name'+(i+1)).val(data[i].SKIL_NAME);
                }
            }
        });

    };

    document.getElementById("modal_close_btn").onclick = function() {
        window.history.back();
    }
    var count = 1;
    $(document).on("click","button[name=addStaff]",function(){
        console.log('add');
        count += 1;

        var addStaffText =
            '<tr name="trSkil">'+
            '        <td id="staff_name"></td>'+
            '        <td><select size ="1" class="form-control" id = "req_skil_divs'+count+'" name = "req_skil_divs'+count+'" onchange="skil_chg('+count+')">'+
            '                <option>선택</option>'+
            '                <option value = "01">DB</option>'+
            '                <option value = "02">LANGUAGE</option>'+
            '                <option value = "03">WEB</option>'+
            '                <option value = "04">MIDWARE</option>'+
            '                <option value = "05">Framework</option>'+
            '            </select></td>'+
            '        <td><select class="form-control" id = "req_skil_name'+count+'" name = "req_skil_name'+count+'"></select></td>'+
            '        <td><input type="button" style="float:right" id="del" name="delStaff" value="삭제" class = "btn btn-primary"/></td>'+
            '</tr>';

        var trHtml = $( "tr[name=trSkil]:last" );

        trHtml.after(addStaffText);

        console.log($('#reqSkil tbody tr').length);

    });

    $(document).on("click","input[name=delStaff]",function(){
<!--        var table = document.getElementById('reqSkilBody');-->
<!--        if (table.rows.length < 2) return;-->

<!--        $('#reqSkil tbody tr:last').remove();-->
        console.log('del')
        var trHtml = $(this).parent().parent();

        trHtml.remove();
    });


    $('#modal_save_btn').click(function(){
            $('#trCount').val($('#reqSkil tbody tr').length);

            console.log('저장');
                confirmMsg('저장 하시겠습니까?', function(){
                        $('#projectInfo').ajaxCall({
                        method : 'POST',
                        url : '/skil/prjSave/post',
                        callbackFn : function(data){
                            g_toast.push('저장 되었습니다.');
                        }
                });
            });
    });

    $('#modal_delete_btn').click(function(){
            console.log('삭제');
            confirmMsg('삭제 하시겠습니까?', function(){
                    $('#projectInfo').ajaxCall({
                    method : 'POST',
                    url : '/skil/prjDelete/post',
                    callbackFn : function(data){
                       g_toast.push('삭제 되었습니다.');
                    }
                });

            });
     });

    function skil_chg(a){
        console.log('스킬 변경');
        var DB = ["Oracle","MySql","MsSql"];

        var Language = ["C","C++","C#","JAVA","Python"];

        var WEB = ["HTML","JavaScript","CSS"];

        var MIDWARE = ["RPC", "MOM", "ORB"];

        var Framework = [".net", "Spring"];


        var selectSkill = $("#req_skil_divs"+a).val();

        var changeSkill;
        var changeSkillValue;

        if(selectSkill == "01"){
          changeSkill = DB;

        }
        else if(selectSkill == "02"){
          changeSkill = Language;

        }
        else if(selectSkill == "03"){
          changeSkill =  WEB;

        }
        else if(selectSkill == "04"){
          changeSkill =  MIDWARE;

        }
        else if(selectSkill == "05"){
          changeSkill =  Framework;

        }

        $("#req_skil_name"+a).empty();

        for(var count = 0; count < changeSkill.length; count++){
                        var option = $("<option>"+changeSkill[count]+"</option>");
                        $('#req_skil_name'+a).append(option);
                    }

    };



</script>



{% endblock %}

