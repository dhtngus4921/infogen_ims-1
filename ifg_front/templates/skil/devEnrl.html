{% extends 'common/base.html' %}

{% block content %}

 <style>
#modal {
  position:relative;
  width:100%;
  height:100%;
  z-index:1;
}

#modal h2 {
  margin:0;
}

#modal input {
  width : 100%;
  border: 0;
  border-bottom: 1px solid #0489B1;
  outline : 0;
}

#modal button {
  display:inline-block;
  width:33%;
  margin-center:calc(100% - 100px - 10px);
  float:left;
  color: blue;
  background-color: rgba(0,0,0,0);
  border: 0;
  outline : 0;

}

#modal .modal_content {
  width:600px;
  margin:100px auto;
  padding:0px 40px;
  background:#fff;
  border:2px solid #666;
}

#modal .modal_layer {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgb(0, 0, 0, 0.5);
  z-index:-1;
}

</style>

<div id="modal">
    <div class="modal_content">
            <h2 style = "font-weight:bold"><U>개발자 등록</U></h2><br>
        <div id = developerEnrollment>
            <span style="color: #0489B1;
                         font-size: 1.0em;
                         padding:20px;">
                <p style = "display:none">사번<br>
                    <input type = "text" id = "emp_no" name = "emp_no"></p>

                <p>*성명<br>
                    <input type = "text" id = "emp_name" name = "emp_name" placeholder="input text"></p>

                <p>*부서<br>
                    <select size ="1" width="50px" id = "emp_dept" name = "emp_dept" class="col-sm-4">
                        <option value = "">선택</option>
                    </select></p>

                <p>직급<br>
                    <select size ="1" width="50px" id = "emp_rank" name = "emp_rank" class = "col-sm-2">
                        <option value = "">선택</option>
                    </select></p>

                <p>*등급<br>
                    <select size ="1" width="50px" id = "devp_grd" name = "devp_grd" class = "col-sm-2">
                        <option value = "">선택</option>
                    </select></p>

                <p>*연락처<br>
                        <input type = "text" id = "tel_no1" name = "tel_no1" style = "width : 20%" placeholder="000"
                               maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                        - <input type = "text" id = "tel_no2" name = "tel_no2" style = "width : 20%" placeholder="0000"
                                 maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                        - <input type = "text" id = "tel_no3" name = "tel_no3" style = "width : 20%" placeholder="0000"
                                 maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '');"></p>

                <p>*계약구분<br>
                    <select size ="1" width="50px" id = "cntc_divs" name = "cntc_divs" class="col-sm-2">
                        <option value = "">선택</option>
                        <option value = "02">프리</option>
                        <option value = "03">외주</option>
                    </select></p>

                <p>소속사<br>
                    <input type = "text" id = "devp_blco" name = "devp_blco" placeholder="input text"></p>

                <p>*생년월일<br>
                    <input type = "date" id = "devp_bday" name = "devp_bday" style = "width : 50%"></p>

                <p>비고<br>
                    <input type = "text" id = "rmks" name = "rmks" placeholder="input text" style="width:500px"></p>
            </span>
            </div>
            <hr>
                    <button type="button" id="closeBtn">닫기</button>
                    <button type="button" id="saveBtn">저장</button>
                    <button type="button" id="deleteBtn" style="color:red">삭제</button>
    </div>

<script>
    $(document).ready(function() {
        <!--    공통코드 조회    -->
        retrieveCmmCd('emp_dept', 'SLIN_BZDP');
        retrieveCmmCd('emp_rank', 'EMP_RANK_CD');
        retrieveCmmCd('devp_grd', 'DEVP_GRD_CD');

        var emp_no = location.href.indexOf('emp_No');
        <!--   개발자 정보 수정    -->
        if(emp_no != -1){
            console.log('emp_no : '+ emp_no);
            temp=location.href.split("?");
            data = temp[1].split("=");
            emp_no = data[1];
            $('#emp_no').val(emp_no);

            retrieveDevInfo();
        } else{  <!--   개발자 최초 등록    -->
            console.log('emp_no is null')
        }
    });

    function retrieveDevInfo(){
            $('#developerEnrollment').ajaxCall({
                 method : 'GET',
                 url : "{% url 'skil_api:retrieveDevInfo' %}",
                 callbackFn : function(data){
                    $('#emp_name').val(data[0].EMP_NAME);
                    $('#emp_dept').val(data[0].EMP_DEPT_CD);
                    $('#emp_rank').val(data[0].EMP_RANK_CD);
                    $('#devp_grd').val(data[0].DEVP_GRD_CD);
                    var tel_no = data[0].DEVP_TEL_NO.split('-');
                    var tel_no1 = tel_no[0];
                    var tel_no2 = tel_no[1];
                    var tel_no3 = tel_no[2];
                    $('#cntc_divs').val(data[0].CNTC_DIVS_CD);
                    $('#tel_no1').val(tel_no1);
                    $('#tel_no2').val(tel_no2);
                    $('#tel_no3').val(tel_no3);
                    $('#devp_blco').val(data[0].DEVP_BLCO);
                    $('#devp_bday').val(data[0].DEVP_BDAY);
                    $('#rmks').val(data[0].RMKS);
                 }
            });
    };

    function retrieveCmmCd(sbx_id, grp_id){
        var param = {
            "sbx_id" : sbx_id,
            "grp_id" : grp_id
        }

         $.ajaxCall( param, {
                 method : 'GET',
                 'url' : '/skil/retrieveCmmCd/',
                 'dataType' : 'json',
                 'data' : JSON.stringify(param),
                 'async' : false,
                 'callbackFn' : function(data){
                    for(var i = 0; i < data.length; i++){
                        var option = $("<option value = "+data[i].CMM_CD+">"+data[i].CMM_CD_NAME+"</option>");
                        $('#'+sbx_id).append(option);
                    }
                 }
         });
     };

    $('#saveBtn').click(function(){
        var emp_name = $('#emp_name').val();
        var emp_dept = $('#emp_dept').val();
        var dept_grd = $('#devp_grd').val();
        var cntc_divs = $('#cntc_divs').val();
        var tel_no1 = $('#tel_no1').val();
        var tel_no2 = $('#tel_no2').val();
        var tel_no3 = $('#tel_no3').val();
        var devp_bday = $('#devp_bday').val();

        if(emp_name == '' || emp_name == null){
            alertMsg('성명은(는) 필수 입력 사항입니다.');
            return false;
        } else if(emp_dept == '' || emp_dept == null){
           alertMsg('부서은(는) 필수 입력 사항입니다.');
           return false;
        } else if(dept_grd == '' || dept_grd == null){
            alertMsg('등급은(는) 필수 입력 사항입니다.');
            return false;
        } else if(cntc_divs == '' || cntc_divs == null){
            alertMsg('계약구분은(는) 필수 입력 사항입니다.');
            return false;
        } else if(tel_no1 == '' || tel_no1 == null ||
                  tel_no2 == '' || tel_no2 == null ||
                  tel_no3 == '' || tel_no3 == null){
            alertMsg('연락처은(는) 필수 입력 사항입니다.');
            return false;
        } else if(devp_bday == '' || devp_bday == null){
            alertMsg('생년월일은(는) 필수 입력 사항입니다.');
            return false;
        }

        console.log('저장');
        confirmMsg('저장 하시겠습니까?', function(){

            $('#developerEnrollment').ajaxCall({
                method : 'POST',
                url : '/skil/devSave/post',
                callbackFn : function(data){
                    location.href = '/skil/devEnrl?emp_No='+data
                    g_toast.push('저장 되었습니다.');
                }
            });
        });
    });

    $('#deleteBtn').click(function(){
        console.log('삭제');
        confirmMsg('삭제 하시겠습니까?', function(){
            var emp_no = $('#emp_no').val();
            if(emp_no == '' || emp_no == null){
                alertMsg('등록된 개발자 정보가 없습니다.');
                return false;
            }

            $('#developerEnrollment').ajaxCall({
                method : 'POST',
                url : '/skil/devDelete/post',
                callbackFn : function(data){
                    location.href = '/skil/devEnrl'
                    g_toast.push('삭제 되었습니다.');
                }
            });
        });
    });

    document.getElementById("closeBtn").onclick = function() {
        window.history.back();
    }

</script>

    <div class="modal_layer"></div>
</div>

{% endblock %}